# LinuxCheck

Инструмент для экстренного реагирования в Linux, сбора информации и обнаружения уязвимостей. Поддерживает проверки по 13 категориям и более чем 70 пунктам, включая базовую конфигурацию, сетевой трафик, планировщик задач, переменные окружения, информацию о пользователях, службы, bash, вредоносные файлы, руткиты ядра, SSH, веб-шеллы, майнинговые файлы и процессы, цепочки поставок и риски серверов.

## Дисклеймер

Это форк оригинального проекта LinuxCheck, для адоптации под нужды русскоязычных пользователей.

- Русские комментарии
- Код и результаты - на английском, для больших шансов на понимание  

## Обновления

Журнал обновлений: 20 апреля 2024 года

- Изменён формат вывода на отчёт в формате Markdown.
- Удалён ag, вместо него используется встроенная команда Linux grep, чтобы избежать необходимости дополнительной установки.
- Оптимизирован формат кода, убрано использование tee -a для каждой строки.
- Обновлена логика проверки Webshell.
- Обновлена логика проверки authorized_keys.
- В проверку рисков серверов добавлены JDWP и Python HTTP Server.
- Добавлена проверка контейнеров Docker.
- Добавлена проверка на бэкдоры PAM.
- Добавлена возможность локальной загрузки отчётов для работы с несколькими машинами в экстренных ситуациях.

Журнал обновлений: 5 августа 2022 года

- Исправлена проблема с избыточными логами проверки модулей ядра.

Журнал обновлений: 7 марта 2022 года

- Добавлена проверка на символические ссылки в SSH для обнаружения бэкдоров.

Журнал обновлений: 17 октября 2021 года

- Добавлено обнаружение майнинговых троянов Ntpclient/WorkMiner/TeamTNT.
- Добавлена логика проверки модулей Rootkit.
- Добавлена проверка на отравление Python pip.
- Добавлено отображение содержимого файла $HOME/.profile.
- Добавлена проверка рисков серверов (Redis).

## Функционал

* Проверка базовой конфигурации
    * Изменения в системной конфигурации
    * Информация о системе (IP-адрес, пользователи, время работы, версия системы, Hostname, серийный номер сервера)
    * Использование CPU
    * Информация о вошедших пользователях
    * Топ-15 процессов по загрузке CPU
    * Топ-15 процессов по использованию памяти
    * Проверка свободного места на диске
    * Подключённые диски
    * Проверка установленных программ
    * /etc/hosts
* Проверка сети и трафика
    * ifconfig
    * Сетевой трафик
    * Прослушиваемые порты
    * Открытые внешние порты
    * Сетевые соединения
    * Состояние TCP-соединений
    * Таблица маршрутов
    * Перенаправление маршрутов
    * DNS-серверы
    * ARP
    * Проверка сетевых карт в режиме промискуитета
    * iptables (фаервол)
* Проверка планировщика задач
    * Задачи текущего пользователя
    * Системные задачи в /etc/
    * Время создания файлов задач
    * Проверка на бэкдоры в crontab
* Проверка переменных окружения
    * env
    * path
    * LD_PRELOAD
    * LD_ELF_PRELOAD
    * LD_AOUT_PRELOAD
    * PROMPT_COMMAND
    * LD_LIBRARY_PATH
    * ld.so.preload
* Проверка информации о пользователях
    * Пользователи с доступом
    * Дата изменения файла passwd
    * sudoers
    * Информация о входах (w/last/lastlog)
    * История IP-адресов входов
* Проверка служб
    * Запущенные службы SystemD
    * Время создания служб SystemD
* Проверка bash
    * История команд
    * Аудит истории команд
    * /etc/profile
    * $HOME/.profile
    * /etc/rc.local
    * ~/.bash_profile
    * ~/.bashrc
    * Обратные shell через bash
* Проверка файлов
    * Скрытые файлы
    * Изменения системных файлов
    * Проверка временных файлов (/tmp, /var/tmp, /dev/shm)
    * alias
    * Проверка файлов с suid-правами
    * Процессы с отсутствующими файлами
    * Изменения файлов за последние 7 дней (mtime)
    * Изменения файлов за последние 7 дней (ctime)
    * Большие файлы (>200 МБ)
    * Аудит чувствительных файлов (nmap, sqlmap, ew, frp, nps и другие инструменты хакеров)
    * Подозрительные файлы (вредоносные программы, замаскированные под обычные, например, nps под mysql)
* Проверка руткитов ядра
    * Подозрительные модули lsmod
    * Проверка таблицы символов ядра
    * Проверка с помощью rootkit hunter
    * Проверка модулей руткитов (.ko)
* Проверка SSH
    * Брутфорс SSH
    * Проверка SSHD
    * Проверка конфигурации SSH на бэкдоры
    * Проверка inetd-бэкдоров SSH
    * Проверка SSH-ключей
* Проверка веб-шеллов
    * Проверка php webshell
    * Проверка jsp webshell
* Проверка майнинговых файлов и процессов
    * Проверка файлов для майнинга
    * Проверка процессов для майнинга
    * Обнаружение WorkMiner
    * Обнаружение Ntpclient
* Проверка на отравление цепочек поставок
    * Проверка на отравление Python PIP
* Проверка рисков серверов
    * Проверка слабых паролей Redis
    * Проверка службы JDWP
    * Проверка Python http.server
* Проверка прав Docker

## Использование

Первый способ: установка через git clone

```bash
git clone https://github.com/al0ne/LinuxCheck.git
chmod u+x LinuxCheck.sh
./LinuxCheck.sh  
```
Второй способ: запуск напрямую онлайн (в этом случае возможность загрузки отчёта недоступна)

```bash
bash -c "$(curl -sSL https://raw.githubusercontent.com/msklv/LinuxCheck/master/LinuxCheck.sh)"  
```

Файл будет сохранён в формате ipaddr_hostname_username_timestamp.log.

### Автоматическая загрузка отчётов

Если необходимо массово запускать скрипт на нескольких машинах, после выполнения он автоматически отправит отчёт на указанный URL. Для этого измените переменную `webhook_url` в скрипте на ваш собственный адрес.

```shell
# Адрес для отправки отчётов
webhook_url='http://localhost:5000/upload'
upload_report() {

# Загрузка на указанный интерфейс
  if [[ -n $webhook_url ]]; then
    curl -X POST -F "file=@$filename" "$webhook_url"
  fi

}
```

На вашем сервере можно запустить сервис Flask, который будет принимать отчёты в формате Markdown, отправленные с других серверов.

```python
from flask import Flask, request

app = Flask(__name__)

@app.route('/upload', methods=['POST'])
def upload_file():
    if 'file' not in request.files:
        return "No file part", 400
    file = request.files['file']
    if file.filename == '':
        return "No selected file", 400
    if file:
        filename = file.filename
        file.save(filename)
        return "File successfully uploaded", 200

if __name__ == '__main__':
    app.run(debug=True, host="0.0.0.0", port=9999)
```

## Ссылки

Этот инструмент был создан с учётом следующих инструментов/статей и личного опыта:

Linenum
https://github.com/lis912/Evaluation_tools  
https://ixyzero.com/blog/archives/4.html  
https://github.com/T0xst/linux   
https://github.com/grayddq/GScan  
